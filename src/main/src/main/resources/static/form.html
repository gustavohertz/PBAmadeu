<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Func. - Formulário</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body class="py-4">
<div class="container">
    <h1 id="title">Novo Funcionário</h1>
    <form id="form">
        <input type="hidden" id="id"/>
        <div class="mb-3">
            <label class="form-label">Nome</label>
            <input id="nome" class="form-control" required/>
        </div>
        <div class="mb-3">
            <label class="form-label">CPF</label>
            <input id="cpf" class="form-control" required pattern="\\d{11}"/>
        </div>
        <button class="btn btn-primary" type="submit">Salvar</button>
        <a href="index.html" class="btn btn-secondary">Voltar</a>
    </form>
</div>

<script>
    function save(e) {
        e.preventDefault();
        const id = document.getElementById('id').value || Date.now();
        const nome = document.getElementById('nome').value;
        const cpf = document.getElementById('cpf').value;
        const arr = JSON.parse(localStorage.getItem('funcs') || '[]');
        const idx = arr.findIndex(x => x.id == id);
        const obj = { id, nome, cpf };
        if (idx >= 0) arr[idx] = obj; else arr.push(obj);
        localStorage.setItem('funcs', JSON.stringify(arr));
        alert('Salvo com sucesso');
        location.href = 'index.html';
    }

    document.getElementById('form').addEventListener('submit', save);

    // Se veio hash /editar/ID, preencher campos
    const h = location.hash;
    if (h && h.startsWith('#/editar/')) {
        const id = h.split('/')[2];
        const arr = JSON.parse(localStorage.getItem('funcs') || '[]');
        const obj = arr.find(x => x.id == id);
        if (obj) {
            document.getElementById('id').value = obj.id;
            document.getElementById('nome').value = obj.nome;
            document.getElementById('cpf').value = obj.cpf;
            document.getElementById('title').textContent = 'Editar Funcionário';
        }
    }
</script>
</body>
</html>
